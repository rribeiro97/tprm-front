# CI/CD Setup Guide

## Husky in CI/CD Environments

The `prepare` script in package.json includes `|| true` to prevent build failures in CI/CD environments where git hooks are not needed.

```json
{
  "scripts": {
    "prepare": "husky || true"
  }
}
```

This ensures:
- ✅ Husky installs hooks in local development
- ✅ Build doesn't fail in CI/CD when husky is not available
- ✅ Works in environments without `.git` directory

---

## Vercel Configuration

### Option 1: Use Existing Setup (Recommended)

The `|| true` in the prepare script already handles Vercel deployments. **No additional configuration needed.**

### Option 2: Explicitly Disable Husky (Optional)

If you want to be explicit, add this environment variable in Vercel:

**Environment Variable:**
```
HUSKY=0
```

**Where to add:**
1. Go to Vercel Dashboard
2. Select your project
3. Go to Settings → Environment Variables
4. Add `HUSKY=0` for all environments (Production, Preview, Development)

---

## Other CI/CD Platforms

### GitHub Actions

Add to your workflow file:

```yaml
# .github/workflows/deploy.yml
env:
  HUSKY: 0

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Install dependencies
        run: npm ci
        env:
          HUSKY: 0
      - name: Build
        run: npm run build
```

### GitLab CI

Add to `.gitlab-ci.yml`:

```yaml
variables:
  HUSKY: "0"

build:
  script:
    - npm ci
    - npm run build
```

### CircleCI

Add to `.circleci/config.yml`:

```yaml
jobs:
  build:
    environment:
      HUSKY: 0
    steps:
      - run: npm ci
      - run: npm run build
```

### Netlify

Add to `netlify.toml`:

```toml
[build.environment]
  HUSKY = "0"
```

Or add environment variable in Netlify dashboard:
1. Site settings → Build & deploy → Environment
2. Add `HUSKY=0`

### Docker

Add to your Dockerfile:

```dockerfile
ENV HUSKY=0

RUN npm ci --only=production
RUN npm run build
```

---

## Why This Setup Works

### The Problem

Husky requires:
- A `.git` directory
- Git hooks to be writable
- The `husky` command to be available

CI/CD environments often:
- Don't have `.git` (or it's read-only)
- Don't need git hooks (builds happen in isolation)
- May not have dev dependencies installed

### The Solution

1. **`|| true` in prepare script**
   - If `husky` command fails, the script continues
   - Build doesn't break in CI/CD
   - Still works in local development

2. **`HUSKY=0` environment variable** (optional)
   - Husky checks this variable and skips installation
   - Explicitly disables Husky in CI/CD
   - More explicit than relying on command failure

---

## Testing Your CI/CD Setup

### Test Locally (Simulating CI)

```bash
# Test with HUSKY disabled
HUSKY=0 npm install

# Test with prepare script
npm run prepare

# Test full build
npm run build
```

### Verify Deployment

After deployment, check:
- ✅ Build succeeds without husky errors
- ✅ No warnings about missing git hooks
- ✅ Application runs correctly

---

## Troubleshooting

### Build Fails with "husky: command not found"

**Solution 1:** Ensure `|| true` is in prepare script
```json
"prepare": "husky || true"
```

**Solution 2:** Set `HUSKY=0` environment variable

**Solution 3:** Remove prepare script entirely (not recommended for local dev)

### Husky Installs in CI but Shouldn't

**Check:** Is `HUSKY=0` set?
**Check:** Is `|| true` in prepare script?
**Check:** Are dev dependencies being installed?

### Build Succeeds but Hooks Don't Work Locally

**Check:** Did you run `npm install` after cloning?
**Check:** Is `.husky/` directory present?
**Check:** Run `npm run prepare` manually

---

## Best Practices

1. ✅ **Keep `|| true` in prepare script**
   - Safeguard against environment issues
   - Doesn't hurt local development

2. ✅ **Set `HUSKY=0` in CI/CD**
   - Explicit is better than implicit
   - Faster builds (skips hook installation)

3. ✅ **Don't commit `.husky/_` directory**
   - Auto-generated by Husky
   - Can cause issues across environments

4. ✅ **Document for team members**
   - New developers should run `npm install`
   - Hooks install automatically

---

## Environment Variables Summary

| Platform | Variable | Value | Required |
|----------|----------|-------|----------|
| Vercel | `HUSKY` | `0` | Optional (script has `\|\| true`) |
| GitHub Actions | `HUSKY` | `0` | Optional |
| GitLab CI | `HUSKY` | `0` | Optional |
| CircleCI | `HUSKY` | `0` | Optional |
| Netlify | `HUSKY` | `0` | Optional |
| Docker | `HUSKY` | `0` | Optional |

**Note:** All are optional because `|| true` in prepare script already handles failures.

---

## Related Documentation

- [HUSKY_SETUP.md](HUSKY_SETUP.md) - Local development setup
- [CLAUDE.md](CLAUDE.md) - Development guidelines

---

**Status:** ✅ CI/CD compatible with `|| true` failsafe
